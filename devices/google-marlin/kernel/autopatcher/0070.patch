diff --git a/fs/namei.c b/fs/namei.c
index f3c8f6b..12846de 100644
--- a/fs/namei.c
+++ b/fs/namei.c
@@ -4247,7 +4247,11 @@
 	unsigned max_links = new_dir->i_sb->s_max_links;
 	struct name_snapshot old_name;
 
-	if (source == target)
+	/*
+	 * Check source == target.
+	 * On overlayfs need to look at underlying inodes.
+	 */
+	if (vfs_select_inode(old_dentry, 0) == vfs_select_inode(new_dentry, 0))
 		return 0;
 
 	error = may_delete(mnt, old_dir, old_dentry, is_dir);
