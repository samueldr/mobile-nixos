{
  mobile-nixos
, fetchFromGitHub
, ...
}:

mobile-nixos.kernel-builder-gcc6 {
  configfile = ./config.aarch64;

  version = "3.18.140";
  src = fetchFromGitHub {
    owner = "android-linux-stable";
    repo = "marlin";
    rev = "b69581b25fa7273424ef78aa82c3fd1dc05db0a9";
    sha256 = "02jj6zxkxx6cynq0rdq4249ns8wwwkybpdkp6gsi7v0y8czfdaj7";
  };

  patches = [
    ./0001-Revert-four-tty-related-commits.patch
    ./0003-arch-arm64-Add-config-option-to-fix-bootloader-cmdli.patch
    ./99_framebuffer.patch
    './autopatcher/0001-0abfe675e27a-PATCH port of grsecuritys denynewusb feature.patch'
    './autopatcher/0002-01d1b7c5c156-PATCH gather extra early boot entropy like PaX.patch'
    './autopatcher/0003-2d85d6882e3b-PATCH use kernel commandline for early entropy.patch'
    './autopatcher/0004-a02b3dd69dfc-PATCH port of grsecuritys DEVICESIDECHANNEL feature.patch'
    './autopatcher/0005-3a0b9bc26b50-PATCH disable ptracescope by default.patch'
    './autopatcher/0006-6db7b6ea5bd6-PATCH arm64 zero the leading stack canary byte.patch'
    './autopatcher/0007-79219ac0b7cc-PATCH add page sanitization  verification.patch'
    './autopatcher/0008-394cc03c5b68-PATCH add slub sanitization.patch'
    './autopatcher/0009-6a257ecd7de4-PATCH slub add check for writeafterfree.patch'
    './autopatcher/0010-a3c4b7c80ade-PATCH disable slab merging.patch'
    './autopatcher/0011-7b7ee0d589e7-PATCH add slub free list XOR encryption.patch'
    './autopatcher/0012-5fd1b5eadf52-PATCH slub add multipurpose random cookies.patch'
    './autopatcher/0013-66479502e845-PATCH slub check cookies in checkheapobject.patch'
    './autopatcher/0014-bb20ba504a1b-PATCH add missing cachefromobj PageSlab check.patch'
    './autopatcher/0015-24e686d8b498-PATCH real slabequalorroot check for MEMCGKMEM.patch'
    './autopatcher/0016-3ab6268a0684-PATCH always perform cachefromobj sanity checks.patch'
    './autopatcher/0017-1c8468b2d4bd-PATCH panic on kmemcachefree with the wrong cache.patch'
    './autopatcher/0018-4022d3d1c52e-PATCH panic on PageSlab  PageCompound in ksize.patch'
    './autopatcher/0019-d81dbddb71d7-PATCH add kmalloc allocsize attributes.patch'
    './autopatcher/0020-299838765487-PATCH add vmalloc allocsize attributes.patch'
    './autopatcher/0021-650b1da7162b-PATCH arm64 properly account for stack rnd in mmap base.patch'
    './autopatcher/0022-a486b31a1cd2-PATCH arm64 determine stack entropy based on mmap entropy.patch'
    './autopatcher/0023-5f06117f6ede-PATCH arm64 move ETDYN base lower in the address space.patch'
    './autopatcher/0024-284614cd0394-PATCH randomize lower bits of the argument block.patch'
    './autopatcher/0025-af8f4d626fb1-PATCH fix qcacld20 buffer overflows.patch'
    './autopatcher/0026-f296b49c4bd3-PATCH disable brk system call.patch'
    './autopatcher/0027-4750ac7f584a-PATCH enable protectedsymlinkshardlinks by default.patch'
    './autopatcher/0028-182e679e85df-PATCH getrandom make blocking until init configurable.patch'
    './autopatcher/0029-abbb184989c4-PATCH wcnss fix 3 byte buffer overflow on MAC change.patch'
    './autopatcher/0030-0eee0fbd41c7-PATCH arm64 crypto increase AES interleave to 4x.patch'
    './autopatcher/0031-4a97abd44329-PATCH arm64crypto issue aeseaesmc instructions in pairs.patch'
    './autopatcher/0032-08c6781cfaa1-PATCH arm64 crypto reduce priority of core AES cipher.patch'
    './autopatcher/0033-0f7214d62588-PATCH mark qcedev data const.patch'
    './autopatcher/0034-63c317dbee97-net Zeroing the structure ethtoolwolinfo in ethtoolgetwol.patch'
    './autopatcher/0035-2c5816b4becc-cuse fix memory leak.patch'
    './autopatcher/0036-6b8d9117ccb4-PATCH net llc use correct size for sysctl timeout entries.patch'
    './autopatcher/0037-db27ebb111e9-net rds use correct size for max unacked packets and bytes.patch'
    './autopatcher/0038-b57a9f68701f-USB whiteheat fix potential nullderef at probe.patch'
    './autopatcher/0039-8e20cf2bce12-Input aiptek  fix crash on detecting device without endpoints.patch'
    './autopatcher/0040-34a893326f04-USB serial visor fix crash on detecting device without writeurbs.patch'
    './autopatcher/0041.patch'
    './autopatcher/0042-4b2b64d5a6eb-PATCH kexecuefi copy secureboot flag in boot params across kexec.patch'
    './autopatcher/0043-eda98796aff0-media mediavividosd fix info leak in ioctl.patch'
    './autopatcher/0044-4b6184336ebb-stagingdgnc fix info leak in ioctl.patch'
    './autopatcher/0045-cbdb967af3d5-KVM svm unconditionally intercept DB.patch'
    './autopatcher/0046-7681f31ec9cd-xenpciback Dont disable PCICOMMAND on PCI device reset.patch'
    './autopatcher/0047.patch'
    './autopatcher/0048-d2b9d2a5ad5e-powerpctm Block signal return setting invalid MSR state.patch'
    './autopatcher/0049-7f821fc9c77a-powerpctm Check for already reclaimed tasks.patch'
    './autopatcher/0050-ab79efab0a0b-ovl fix dentry reference leak.patch'
    './autopatcher/0051.patch'
    './autopatcher/0052.patch'
    './autopatcher/0053.patch'
    './autopatcher/0054-01bba7b17a23-USB visor fix nullderef at probe.patch'
    './autopatcher/0055-8b8addf891de-x86mm32 Enable full randomization on i386 and X8632.patch'
    './autopatcher/0056.patch'
    './autopatcher/0057-b333d32745fe-msmcore debug Update the number of supported pstates.patch'
    './autopatcher/0058.patch'
    './autopatcher/0059-67118716a293-radioiris check argument values before copying the data.patch'
    './autopatcher/0060-28d23d4d7999-spcom check size before calling copytouser.patch'
    './autopatcher/0061-0c0622914ba5-spcom check bufsize validity for user send command.patch'
    './autopatcher/0062-d9d2c405d46c-spcom check buf size for send modified command.patch'
    './autopatcher/0063-3154eb1d263b-ASoC wcd9320 Fix out of bounds for mad input value.patch'
    './autopatcher/0064-065360da7147-ASoC msm qdsp6v2 DAP Add check to validate param length.patch'
    './autopatcher/0065-71fe5361cbef-net ipcrouter fix NULL pointer dereference issue.patch'
    './autopatcher/0066-532c34b5fbf1-s390sclpctl fix potential information leak with devsclp.patch'
    './autopatcher/0067-30a46a4647fd-apparmor fix oops validate buffer size in apparmorsetprocattr.patch'
    './autopatcher/0068.patch'
    './autopatcher/0069.patch'
    './autopatcher/0070.patch'
    './autopatcher/0071-d8649432b96b-PATCH input synaptics allocate heap memory for buffer.patch'
    './autopatcher/0072-ac328eb631fa-ASoC msm qdsp6v2 DAP Add check to validate data length.patch'
    './autopatcher/0073-961e38553aae-ASoC msm qdsp6v2 DAP Allocate param buffer with correct size.patch'
    './autopatcher/0074-c319c2b0926d-ASoC msm qdsp6v2 DAP Add check to validate param length.patch'
    './autopatcher/0075-c3c9341bfdf9-ASoC msm qdsp6v2 DAP Update check to validate data length.patch'
    './autopatcher/0076-6997dcb7ade1-msmcore use getuser API to read userspace datasettings.patch'
    './autopatcher/0077.patch'
    './autopatcher/0078.patch'
    './autopatcher/0079-4afa5f961792-crypto algifhash  Only export and import on sockets with data.patch'
    './autopatcher/0080-93362fa47fe9-sysctl Drop reference added by grabheader in procsysreaddir.patch'
    './autopatcher/0081.patch'
    './autopatcher/0082.patch'
    './autopatcher/0083-c278c253f3d9-net arcemac fix koops caused by skbuff free.patch'
    './autopatcher/0084-faab50984fe6-PATCH USB gadgetfs fix unbounded memory allocation bug.patch'
    './autopatcher/0085-bcdbeb844773-PATCH USB dummyhcd fix bug in stopactivity handle ep0.patch'
    './autopatcher/0086-1c069b057dcf-PATCH USB gadgetfs fix checks of wTotalLength in config.patch'
    './autopatcher/0087-add333a81a16-PATCH USB gadgetfs fix useafterfree bug.patch'
    './autopatcher/0088-0a8fd1346254-PATCH USB fix problems with duplicate endpoint addresses.patch'
    './autopatcher/0089-f9a1c372299f-PATCH ALSA usx2y Fix invalid stream URBs.patch'
    './autopatcher/0090-6815a0b44457-PATCH ALSA bcd2000 Add a sanity check for invalid EPs.patch'
    './autopatcher/0091-389b185cb2f1-FROMLIST CHROMIUM usb gadget configfs Fix KASAN useafterfree.patch'
    './autopatcher/0092-2bf336ed7ff2-ASoC msm qdsp6v2 return error when copy from userspace fails.patch'
    './autopatcher/0093-40efa2534500-input touchscreen gt9xx fix memory corruption in Goodix driver.patch'
    './autopatcher/0094-15ac0595018f-media uvcvideo Prevent heap overflow when accessing mapped controls.patch'
    './autopatcher/0095-7e09f7d5c790-media uvcvideo Prevent heap overflow when accessing mapped controls.patch'
    './autopatcher/0096-fcca203d8e6a-Prevent heap overflow in uvc driver.patch'
    './autopatcher/0097-3f0531e57753-PATCH BACKPORT f2fs sanity check logblocksperseg.patch'
    './autopatcher/0098.patch'
    './autopatcher/0099.patch'
    './autopatcher/0100.patch'
    './autopatcher/0101.patch'
    './autopatcher/0102.patch'
    './autopatcher/0103.patch'
    './autopatcher/0104.patch'
    './autopatcher/0105-9d5a0bc7f631-bluetooth Fix free data pointer routine.patch'
    './autopatcher/0106-1806be003731-msm ba Fix race conditions in debug writes.patch'
    './autopatcher/0107.patch'
    './autopatcher/0108-3ce3b95ae04b-msm camera Unlock rwlock before returning.patch'
    './autopatcher/0109-e97ed214f426-iommu iommudebug cleanup iommu debug.patch'
    './autopatcher/0110.patch'
    './autopatcher/0111-f90aa1b061b9-msm gsi fix memory corruption from debugfs.patch'
    './autopatcher/0112-6504a868cbf6-wil6210 protect against invalid length of tx management frame.patch'
    './autopatcher/0113-c9f4aa94626a-msm camera sensor Validate destination step position.patch'
    './autopatcher/0114-51bda2bca53b-Bluetooth hidpconnectionadd unsafe use of l2cappi.patch'
    './autopatcher/0115.patch'
    './autopatcher/0116.patch'
    './autopatcher/0117-67ad84bd92bb-msm mdss check the length of the external input buffer properly.patch'
    './autopatcher/0118.patch'
    './autopatcher/0119.patch'
    './autopatcher/0120.patch'
    './autopatcher/0121.patch'
    './autopatcher/0122.patch'
    './autopatcher/0123.patch'
    './autopatcher/0124-401dce7cfdfe-input touchscreen fix buffer overflow issue in synaptics driver.patch'
    './autopatcher/0125-1fd3d3d27671-msm mdss Add check to fix null pointer dereference.patch'
    './autopatcher/0126-0d5d87098926-ASoC qdsp6v2 prevent null pointer dereference for volcmds.patch'
    './autopatcher/0127.patch'
    './autopatcher/0128.patch'
    './autopatcher/0129-36ae3c0a36b7-KVM Dont accept obviously wrong gsi values via KVMIRQFD.patch'
    './autopatcher/0130-eab09532d400-binfmtelf use ELFETDYNBASE only for PIE.patch'
    './autopatcher/0131.patch'
    './autopatcher/0132.patch'
    './autopatcher/0133.patch'
    './autopatcher/0134.patch'
    './autopatcher/0135.patch'
    './autopatcher/0136.patch'
    './autopatcher/0137.patch'
    './autopatcher/0138.patch'
    './autopatcher/0139.patch'
    './autopatcher/0140.patch'
    './autopatcher/0141.patch'
    './autopatcher/0142.patch'
    './autopatcher/0143.patch'
    './autopatcher/0144-3b1375201314-msm camera Synchronize camera openclose calls.patch'
    './autopatcher/0145.patch'
    './autopatcher/0146.patch'
    './autopatcher/0147.patch'
    './autopatcher/0148.patch'
    './autopatcher/0149.patch'
    './autopatcher/0150.patch'
    './autopatcher/0151.patch'
    './autopatcher/0152-51e64c856f20-fbdev msm check the length of the external input buffer properly.patch'
    './autopatcher/0153-43268e7260fd-msm kgsl Verify the offset of the profiling buffer.patch'
    './autopatcher/0154-1baff4617b84-msm vidc Avoid information leak while accessing the packet.patch'
    './autopatcher/0155-4b6fb386eeaa-msm qdsp6v2 Check size of payload before access.patch'
    './autopatcher/0156.patch'
    './autopatcher/0157.patch'
    './autopatcher/0158.patch'
    './autopatcher/0159.patch'
    './autopatcher/0160.patch'
    './autopatcher/0161-95baa60a0da8-ipv6sockglue Fix a missingcheck bug in ip6racontrol.patch'
    './autopatcher/0162-f9e3ebeea452-scsi mpt3sasctl fix doublefetch bug in ctlioctlmain.patch'
    './autopatcher/0163-efa9ace68e48-powerpcpseriesdlpar Fix a missing check in.patch'
    './autopatcher/0164.patch'
    './autopatcher/0165.patch'
    './autopatcher/0166.patch'
    './autopatcher/0167-e73a43245a30-net core null pointer derefernce in sockevclientcb.patch'
    './autopatcher/0168-4eb791e7d9ad-msm adm Fix memory overread in adm callback.patch'
    './autopatcher/0169-c4f42c24e02c-qseecom  Clear client handle after unmap the resources.patch'
    './autopatcher/0170-3cca948bcc69-qseecom check invalid handle for app loaded query request.patch'
    './autopatcher/0171-e98691d8f5a0-msm ipa Validate routing rule id.patch'
    './autopatcher/0172-665b0c10e9cf-ion Ensure nonHLOS memory cannot be mapped by CPU.patch'
    './autopatcher/0173-c0cb07498306-diag Mark Buffer as NULL after freeing.patch'
    './autopatcher/0174.patch'
    './autopatcher/0175.patch'
    './autopatcher/0176.patch'
    './autopatcher/0177.patch'
    './autopatcher/0178.patch'
    './autopatcher/0179.patch'
    './autopatcher/0180.patch'
    './autopatcher/0181.patch'
    './autopatcher/0182.patch'
    './autopatcher/0183.patch'
    './autopatcher/0184.patch'
    './autopatcher/0185.patch'
    './autopatcher/0186-6cf97230cd5f-media dvb usb fix use after free in dvbusbdeviceexit.patch'
    './autopatcher/0187.patch'
    './autopatcher/0188.patch'
    './autopatcher/0189.patch'
    './autopatcher/0190.patch'
    './autopatcher/0191.patch'
    './autopatcher/0192.patch'
    './autopatcher/0193.patch'
    './autopatcher/0194.patch'
    './autopatcher/0195.patch'
    './autopatcher/0196.patch'
    './autopatcher/0197.patch'
    './autopatcher/0198.patch'
    './autopatcher/0199.patch'
    './autopatcher/0200-07f12b26e21a-net sit fix memory leak in sitinitnet.patch'
    './autopatcher/0201.patch'
    './autopatcher/0202.patch'
    './autopatcher/0203.patch'
    './autopatcher/0204.patch'
    './autopatcher/0205.patch'
    './autopatcher/0206.patch'
    './autopatcher/0207.patch'
    './autopatcher/0208.patch'
    './autopatcher/0209.patch'
    './autopatcher/0210.patch'
    './autopatcher/0211.patch'
    './autopatcher/0212-6f3ef5c25cc7-wimax i2400 Fix memory leak in i2400moprfkillswtoggle.patch'
    './autopatcher/0213-2507e6ab7a9a-wimax i2400 fix memory leak.patch'
    './autopatcher/0214.patch'
    './autopatcher/0215.patch'
    './autopatcher/0216.patch'
    './autopatcher/0217.patch'
    './autopatcher/0218.patch'
    './autopatcher/0219.patch'
    './autopatcher/0220.patch'
    './autopatcher/0221.patch'
    './autopatcher/0222.patch'
    './autopatcher/0223.patch'
    './autopatcher/0224.patch'
    './autopatcher/0225.patch'
    './autopatcher/0226.patch'
    './autopatcher/0227.patch'
    './autopatcher/0228.patch'
    './autopatcher/0229.patch'
    './autopatcher/0230.patch'
    './autopatcher/0231.patch'
    './autopatcher/0232.patch'
    './autopatcher/0233-c468a8aa790e-usb iowarrior fix deadlock on disconnect.patch'
    './autopatcher/0234-edc4746f253d-USB iowarrior fix useafterfree on disconnect.patch'
    './autopatcher/0235.patch'
    './autopatcher/0236.patch'
    './autopatcher/0237.patch'
    './autopatcher/0238.patch'
    './autopatcher/0239.patch'
    './autopatcher/0240.patch'
    './autopatcher/0241.patch'
    './autopatcher/0242.patch'
    './autopatcher/0243.patch'
    './autopatcher/0244.patch'
    './autopatcher/0245.patch'
    './autopatcher/0246.patch'
    './autopatcher/0247.patch'
    './autopatcher/0248.patch'
    './autopatcher/0249.patch'
    './autopatcher/0250.patch'
    './autopatcher/0251.patch'
    './autopatcher/0252.patch'
    './autopatcher/0253.patch'
    './autopatcher/0254.patch'
    './autopatcher/0255.patch'
    './autopatcher/0256-56a47720a322-PATCH binder fix UAF when releasing todo list.patch'
    './autopatcher/0257.patch'
    './autopatcher/0258.patch'
    './autopatcher/0259.patch'
    './autopatcher/0260.patch'
    './autopatcher/0261.patch'
    './autopatcher/0262-4d40559e5966-PATCH msm vidc remove additional checks in responsehandler.patch'
    './autopatcher/0263.patch'
    './autopatcher/0264.patch'
    './autopatcher/0265.patch'
    './autopatcher/0266.patch'
    './autopatcher/0267.patch'
    './autopatcher/0268.patch'
    './autopatcher/0269.patch'
    './autopatcher/0270.patch'
    './autopatcher/0271.patch'
    './autopatcher/0272-b8e51a6a9db9-s390cmm fix information leak in cmmtimeouthandler.patch'
    './autopatcher/0273.patch'
    './autopatcher/0274-76a699e746c9-net sockev avoid races between sockev and socketclose.patch'
    './autopatcher/0275-20e2434473b2-msm kgsl Correctly clean up dma buffer attachment in case of error.patch'
    './autopatcher/0276-6b3e480f729f-crypto Fix possible stack out of bound error.patch'
    './autopatcher/0277-b2d624743de4-crypto Fix possible stack out of bound error.patch'
    './autopatcher/0278-a3c08f0483dd-msm kgsl Remove VMMAYWRITE flag to restrict mprotect.patch'
    './autopatcher/0279-79856f1b189f-usb dwc3 ep0 Return from handlestatus if ep0delegatereq.patch'
    './autopatcher/0280-5e0deed5892b-msm kgsl Dont allow reimporting memory owned by KGSL.patch'
    './autopatcher/0281.patch'
    './autopatcher/0282.patch'
    './autopatcher/0283.patch'
    './autopatcher/0284-998912346c0d-media ov519 add missing endpoint sanity checks.patch'
    './autopatcher/0285.patch'
    './autopatcher/0286.patch'
    './autopatcher/0287.patch'
    './autopatcher/0288.patch'
    './autopatcher/0289.patch'
    './autopatcher/0290.patch'
    './autopatcher/0291-d47a5dc2888f-sunrpc svcauthgssregisterpseudoflavor must reject duplicate.patch'
    './autopatcher/0292.patch'
    './autopatcher/0293.patch'
    './autopatcher/0294.patch'
    './autopatcher/0295.patch'
    './autopatcher/0296.patch'
    './autopatcher/0297.patch'
    './autopatcher/0298.patch'
    './autopatcher/0299.patch'
    './autopatcher/0300-97d7817dcebb-PATCH netpacket fix overflow in tpacketrcv.patch'
    './autopatcher/0301.patch'
    './autopatcher/0302.patch'
    './autopatcher/0303.patch'
    './autopatcher/0304.patch'
    './autopatcher/0305.patch'
    './autopatcher/0306.patch'
    './autopatcher/0307.patch'
    './autopatcher/0308.patch'
    './autopatcher/0309.patch'
    './autopatcher/0310.patch'
    './autopatcher/0311.patch'
    './autopatcher/0312.patch'
    './autopatcher/0313.patch'
    './autopatcher/0314.patch'
    './autopatcher/0315.patch'
    './autopatcher/0316.patch'
    './autopatcher/0317.patch'
    './autopatcher/0318.patch'
    './autopatcher/0319.patch'
    './autopatcher/0320.patch'
    './autopatcher/0321.patch'
    './autopatcher/0322.patch'
    './autopatcher/0323.patch'
    './autopatcher/0324.patch'
    './autopatcher/0325.patch'
    './autopatcher/0326.patch'
    './autopatcher/0327.patch'
    './autopatcher/0328.patch'
    './autopatcher/0329.patch'
    './autopatcher/0330.patch'
    './autopatcher/0331.patch'
    './autopatcher/0332-8f9138d6c464-PATCH ANDROID xtqtaguid Remove tagentry from process list on untag.patch'
    './autopatcher/0333.patch'
    './autopatcher/0334.patch'
    './autopatcher/0335.patch'
    './autopatcher/0336.patch'
    './autopatcher/0337.patch'
    './autopatcher/0338-6a137caec23a-Bluetooth fix the erroneous flushwork order.patch'
    './autopatcher/0339-e305509e678b-Bluetooth use correct lock to prevent UAF of hdev object.patch'
    './autopatcher/0340.patch'
    './autopatcher/0341.patch'
    './autopatcher/0342.patch'
    './autopatcher/0343.patch'
    './autopatcher/0344.patch'
    './autopatcher/0345.patch'
    './autopatcher/0346.patch'
    './autopatcher/0347.patch'
    './autopatcher/0348.patch'
    './autopatcher/0349.patch'
    './autopatcher/0350.patch'
    './autopatcher/0351.patch'
    './autopatcher/0352-39a4e1c2675a-ozwpan Use unsigned ints to prevent heap overflow.patch'
    './autopatcher/0353-e1f31f3f20ab-tcp fix zero cwnd in tcpcwndreduction.patch'
    './autopatcher/0354-49d27afe9a76-ASoC msm qdsp6v2 DAP Add check to validate param length.patch'
    './autopatcher/0355-65009746a6e6-ASoC msm qdsp6v2 return error when copy from userspace fails.patch'
    './autopatcher/0356.patch'
    './autopatcher/0357.patch'
  ];

  enableRemovingWerror = true;
  isImageGzDtb = true;
  isModular = false;
}
